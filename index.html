<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Oracle Ethics M1 - Philosophical AI</title>
  <link rel="stylesheet" href="./styles.css"/>
  <script>
    // Set your backend URL here (Render)
    window.BACKEND_URL = "https://oracle-philosophy-backend.onrender.com";
    
    // Global state for real data
    window.APP_STATE = {
      consultationCount: 0,
      blockchainData: [],
      stats: {
        truthRate: 0,
        avgDeception: 0,
        avgDeterminacy: 0
      }
    };
  </script>
</head>
<body>
  <!-- Tech Grid Background -->
  <div class="tech-grid"></div>
  
<header class="topbar">
  <div class="brand">Oracle Ethics M1</div>
  <nav>
    <a href="#oracle">Oracle</a>
    <a href="#dashboard">Transparency</a>
    <a href="#philosophy">Philosophy</a>
    <a href="#docs">Docs</a>
    <a href="#contact">Contact</a>
  </nav>
</header>

<main>
  <!-- ORACLE -->
  <section id="oracle" class="card">
    <h2>Consult the Philosophical Oracle</h2>
    <div class="form-row">
      <label>Your Question</label>
      <textarea id="q" rows="4" placeholder="Ask deep questions about life, ethics, meaning... e.g. What is the purpose of suffering? How should I live authentically?"></textarea>
    </div>
    <div class="form-row">
      <label>Session ID (optional)</label>
      <input id="sid" placeholder="auto-generate if empty"/>
    </div>
    <button id="askBtn" class="primary-btn">Seek Wisdom</button>

    <div id="answerBox" class="answer hide">
      <h3>Oracle's Wisdom</h3>
      <div class="philosophy-header">
        <div class="framework-badge" id="frameworkBadge">
          <span id="frameworkText"></span>
        </div>
        <div class="philosopher-ref">
          Through the lens of <strong id="philosopherText"></strong>
        </div>
      </div>
      <p id="answerText" class="wisdom-text"></p>
      
      <div class="analysis-grid">
        <div class="analysis-column">
          <h4>Philosophical Analysis</h4>
          <div class="metrics">
            <div>Wisdom Type: <span id="kind"></span></div>
            <div>Framework: <span id="framework"></span></div>
            <div>Philosopher: <span id="philosopher"></span></div>
            <div>Depth Score: <span id="depth"></span></div>
          </div>
        </div>
        <div class="analysis-column">
          <h4>Ethical Metrics</h4>
          <div class="metrics">
            <div>Determinacy: <span id="det"></span></div>
            <div>Deception Prob.: <span id="dec"></span></div>
            <div>Risk Tags: <span id="risk"></span></div>
            <div>Block Hash: <span id="blockHash" class="hash"></span></div>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- DASHBOARD -->
  <section id="dashboard" class="card">
    <h2>Wisdom Transparency Dashboard</h2>
    <div class="stats-grid">
      <div class="stat-card">
        <div class="stat-value" id="reqCount">0</div>
        <div class="stat-label">Total Consultations</div>
      </div>
      <div class="stat-card">
        <div class="stat-value" id="truthRate">‚Äî</div>
        <div class="stat-label">Wisdom Rate</div>
      </div>
      <div class="stat-card">
        <div class="stat-value" id="avgDec">‚Äî</div>
        <div class="stat-label">Avg. Deception</div>
      </div>
      <div class="stat-card">
        <div class="stat-value" id="avgDet">‚Äî</div>
        <div class="stat-label">Avg. Clarity</div>
      </div>
    </div>

    <div class="table-container">
      <table class="table" id="logTable">
        <thead>
          <tr>
            <th>Time</th>
            <th>Framework</th>
            <th>Philosopher</th>
            <th>Question</th>
            <th>Answer</th>
            <th>Clarity</th>
            <th>Risk</th>
          </tr>
        </thead>
        <tbody id="logBody">
          <!-- Dynamic data will be populated by JavaScript -->
        </tbody>
      </table>
    </div>
    <button id="refreshBtn" class="secondary-btn">Refresh Wisdom Log</button>
  </section>

  <!-- PHILOSOPHY GUIDE -->
  <section id="philosophy" class="card">
    <h2>Philosophical Frameworks</h2>
    <div class="frameworks-grid">
      <div class="framework-card stoicism">
        <h3>üèõÔ∏è Stoicism</h3>
        <p>Focus on what you can control, accept what you cannot. Virtue as the highest good.</p>
        <div class="philosophers">Marcus Aurelius, Seneca, Epictetus</div>
      </div>
      <div class="framework-card existentialism">
        <h3>üé≠ Existentialism</h3>
        <p>Existence precedes essence. We create meaning through authentic choices and actions.</p>
        <div class="philosophers">Sartre, Camus, Nietzsche</div>
      </div>
      <div class="framework-card taoism">
        <h3>‚òØÔ∏è Taoism</h3>
        <p>Harmony with the natural way. Wu wei - action through non-action.</p>
        <div class="philosophers">Laozi, Zhuangzi, Liezi</div>
      </div>
      <div class="framework-card buddhism">
        <h3>ü™∑ Buddhism</h3>
        <p>End suffering through mindfulness and detachment from craving and aversion.</p>
        <div class="philosophers">Buddha, Nagarjuna, Thich Nhat Hanh</div>
      </div>
    </div>
  </section>

  <!-- DOCS -->
  <section id="docs" class="card">
    <div class="docs-layout">
      <aside class="docs-nav">
        <h3>Documentation</h3>
        <ul>
          <li><a href="#frameworks" class="nav-link">Philosophical Frameworks</a></li>
          <li><a href="#how-it-works" class="nav-link">How It Works</a></li>
          <li><a href="#blockchain-logs" class="nav-link">Blockchain Logs</a></li>
          <li><a href="#downloads" class="nav-link">Downloads</a></li>
        </ul>
      </aside>

      <div class="docs-content">
        <h2 id="frameworks">How This Oracle Works</h2>
        
        <div class="content-section">
          <h3>Philosophical AI Engine</h3>
          <p>
            This oracle analyzes your questions through multiple philosophical frameworks - Stoicism, Existentialism, Taoism, and Buddhism. 
            It references classical philosophers and adapts their wisdom to modern dilemmas.
          </p>
        </div>

        <div class="content-section" id="how-it-works">
          <h3>Blockchain Wisdom Ledger</h3>
          <p>
            Every consultation is permanently recorded on an immutable blockchain. This ensures complete transparency 
            and allows verification of the oracle's consistency and ethical integrity.
          </p>
        </div>

        <div class="content-section">
          <h3>Deception Detection System</h3>
          <p>
            Advanced algorithms detect manipulative language, absolutist claims, and high-risk domains. 
            The system maintains ethical boundaries while providing profound insights.
          </p>
        </div>

        <div class="content-section">
          <h3>Determinacy & Clarity Scoring</h3>
          <p>
            Answers are scored for clarity (0-1) based on specificity and actionable wisdom. 
            Higher scores indicate more direct guidance, while lower scores suggest contemplative insights.
          </p>
        </div>

        <div class="content-section" id="blockchain-logs">
          <h3>Recent Blockchain Activity</h3>
          <div class="table-container">
            <table class="table blockchain-table">
              <thead>
                <tr>
                  <th>Block</th>
                  <th>Question</th>
                  <th>Framework</th>
                  <th>Hash</th>
                </tr>
              </thead>
              <tbody id="blockchainBody">
                <!-- Dynamic blockchain data -->
              </tbody>
            </table>
          </div>
        </div>

        <div class="content-section" id="downloads">
          <h3>Documentation Downloads</h3>
          <div class="download-grid">
            <a href="https://raw.githubusercontent.com/yumi951357/oracle-philosophy-frontend/main/public/whitepaper.pdf" class="download-card" download="Technical_Whitepaper.pdf">
              <div class="download-icon">üìÑ</div>
              <div class="download-info">
                <h4>Technical Whitepaper</h4>
                <p>Complete technical documentation and architecture</p>
              </div>
            </a>
            <a href="https://raw.githubusercontent.com/yumi951357/oracle-philosophy-frontend/main/public/ritual-handbook.pdf" class="download-card" download="Ritual_Handbook.pdf">
              <div class="download-icon">üîÆ</div>
              <div class="download-info">
                <h4>Ritual Handbook</h4>
                <p>Philosophical foundations and usage guidelines</p>
              </div>
            </a>
            <a href="#" class="download-card" onclick="showComingSoon()">
              <div class="download-icon">‚ö°</div>
              <div class="download-info">
                <h4>API Documentation</h4>
                <p>Complete API reference and integration guide</p>
                <small style="color: #888;">Coming Soon</small>
              </div>
            </a>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- CONTACT -->
  <section id="contact" class="card">
    <h2>Contact & Contribution</h2>
    <p>This is an open experiment in philosophical AI and ethical technology.</p>
    <div class="contact-links">
      <p>üìß Email: <a href="mailto:renshijian0258@proton.me">renshijian0258@proton.me</a></p>
      <p>‚úàÔ∏è Telegram: <a href="https://t.me/renshijian0" target="_blank">t.me/renshijian0</a></p>
      <p>üí° GitHub: <a href="https://github.com/yumi951357/oracle-philosophy-frontend" target="_blank">View Source Code</a></p>
    </div>
  </section>
</main>

<footer class="footer">
  <span>"After the blackout, the true light appears." - A space for collective wisdom</span>
</footer>

<script src="./main.js"></script>
<script>
// Enhanced Dashboard Functionality
document.addEventListener('DOMContentLoaded', function() {
  // Initialize real data system
  initializeRealData();
  
  // Refresh button functionality
  document.getElementById('refreshBtn').addEventListener('click', function() {
    refreshDashboardData();
  });
  
  // Enhanced question validation
  const askBtn = document.getElementById('askBtn');
  const questionInput = document.getElementById('q');
  
  // Override or enhance the existing ask functionality
  const originalAskFunction = askBtn.onclick;
  askBtn.onclick = function() {
    const question = questionInput.value.trim();
    
    // Enhanced ethical checking
    if (isUnethicalQuestion(question)) {
      showEthicalWarning(question);
      return false;
    }
    
    // If passes checks, continue with original function
    if (originalAskFunction) {
      return originalAskFunction();
    }
  };
});

// Initialize real data system
function initializeRealData() {
  // Load from localStorage or initialize
  const savedData = localStorage.getItem('oracleDashboardData');
  if (savedData) {
    const data = JSON.parse(savedData);
    window.APP_STATE.consultationCount = data.consultationCount || 0;
    window.APP_STATE.blockchainData = data.blockchainData || [];
    window.APP_STATE.stats = data.stats || window.APP_STATE.stats;
  }
  
  updateDashboardDisplay();
}

// Update dashboard display with real data
function updateDashboardDisplay() {
  // Update statistics cards
  document.getElementById('reqCount').textContent = window.APP_STATE.consultationCount;
  document.getElementById('truthRate').textContent = window.APP_STATE.stats.truthRate.toFixed(1) + '%';
  document.getElementById('avgDec').textContent = window.APP_STATE.stats.avgDeception.toFixed(2);
  document.getElementById('avgDet').textContent = window.APP_STATE.stats.avgDeterminacy.toFixed(2);
  
  // Update tables
  updateLogTable();
  updateBlockchainTable();
}

// Update consultation log table
function updateLogTable() {
  const logBody = document.getElementById('logBody');
  logBody.innerHTML = '';
  
  if (window.APP_STATE.blockchainData.length === 0) {
    // Show placeholder if no data
    const row = document.createElement('tr');
    row.innerHTML = `
      <td colspan="7" style="text-align: center; color: #888;">
        No consultation records yet. Ask the oracle first.
      </td>
    `;
    logBody.appendChild(row);
  } else {
    // Display real consultation data
    window.APP_STATE.blockchainData.slice().reverse().forEach(entry => {
      const row = document.createElement('tr');
      row.innerHTML = `
        <td>${entry.time}</td>
        <td>${entry.framework}</td>
        <td>${entry.philosopher}</td>
        <td title="${entry.question}">${truncateText(entry.question, 30)}</td>
        <td title="${entry.answer}">${truncateText(entry.answer, 50)}</td>
        <td>${entry.determinacy}</td>
        <td class="risk-${entry.risk.toLowerCase().replace(' ', '-')}">${entry.risk}</td>
      `;
      logBody.appendChild(row);
    });
  }
}

// Update blockchain activity table
function updateBlockchainTable() {
  const blockchainBody = document.getElementById('blockchainBody');
  blockchainBody.innerHTML = '';
  
  if (window.APP_STATE.blockchainData.length === 0) {
    const row = document.createElement('tr');
    row.innerHTML = `
      <td colspan="4" style="text-align: center; color: #888;">
        Waiting for first consultation...
      </td>
    `;
    blockchainBody.appendChild(row);
  } else {
    // Show latest 4 entries
    const recentEntries = window.APP_STATE.blockchainData.slice(-4).reverse();
    recentEntries.forEach((entry, index) => {
      const row = document.createElement('tr');
      row.innerHTML = `
        <td>#${String(window.APP_STATE.blockchainData.length - index).padStart(3, '0')}</td>
        <td title="${entry.question}">${truncateText(entry.question, 25)}</td>
        <td>${entry.framework}</td>
        <td class="hash">${entry.blockHash || generateRandomHash()}</td>
      `;
      blockchainBody.appendChild(row);
    });
  }
}

// Refresh dashboard data
function refreshDashboardData() {
  console.log('Refreshing dashboard data...');
  
  // In a real implementation, this would fetch from your backend API
  // For now, we'll update with current local state
  updateDashboardDisplay();
  
  showNotification('Dashboard data refreshed successfully', 'success');
}

// Enhanced unethical question detection
function isUnethicalQuestion(question) {
  const unethicalPatterns = [
    /deceive|deception|fraud|scam|cheat|manipulate|trick|fake|forge/i,
    /harm|hurt|violence|attack|destroy|kill|injure/i,
    /illegal|unlawful|crime|criminal|hack|steal|rob|theft/i,
    /perfect.*fraud|fraud.*strategy|manipulate.*technique/i,
    /hide.*justified|justified.*hide|conceal.*reasonable/i,
    /counterfeit.*method|fake.*method|forgery.*technique/i
  ];
  
  return unethicalPatterns.some(pattern => pattern.test(question));
}

// Show ethical warning instead of answering
function showEthicalWarning(question) {
  const answerBox = document.getElementById('answerBox');
  answerBox.classList.remove('hide');
  
  document.getElementById('frameworkText').textContent = 'Ethical Boundary';
  document.getElementById('philosopherText').textContent = 'System Guardian';
  document.getElementById('answerText').textContent = 
    'For ethical reasons, I cannot answer questions involving deception, harm, or illegal activities. Philosophical wisdom should be used for self-improvement and understanding existence, not for manipulating others. Please rephrase your question constructively.';
  
  document.getElementById('kind').textContent = 'Ethical Protection';
  document.getElementById('framework').textContent = 'System Ethics';
  document.getElementById('philosopher').textContent = 'AI Guardian';
  document.getElementById('depth').textContent = '100%';
  document.getElementById('det').textContent = '1.00';
  document.getElementById('dec').textContent = '0.00';
  document.getElementById('risk').textContent = 'Ethical Rejection';
  document.getElementById('blockHash').textContent = 'eth_protection_' + Date.now();
}

// Utility functions
function truncateText(text, maxLength) {
  return text.length > maxLength ? text.substring(0, maxLength) + '...' : text;
}

function generateRandomHash() {
  return Math.random().toString(36).substring(2, 15) + Math.random().toString(36).substring(2, 15);
}

function showNotification(message, type = 'info') {
  const notification = document.createElement('div');
  notification.className = `notification ${type}`;
  notification.textContent = message;
  notification.style.cssText = `
    position: fixed;
    top: 20px;
    right: 20px;
    background: ${type === 'success' ? '#4CAF50' : '#2196F3'};
    color: white;
    padding: 12px 20px;
    border-radius: 4px;
    z-index: 1000;
    animation: slideIn 0.3s ease;
    box-shadow: 0 4px 12px rgba(0,0,0,0.3);
  `;
  
  document.body.appendChild(notification);
  
  setTimeout(() => {
    notification.style.animation = 'slideOut 0.3s ease';
    setTimeout(() => {
      notification.remove();
    }, 300);
  }, 3000);
}

function showComingSoon() {
  showNotification('API documentation coming soon!', 'info');
}

// Add CSS animations and styles
const enhancedStyles = document.createElement('style');
enhancedStyles.textContent = `
  @keyframes slideIn {
    from { transform: translateX(100%); opacity: 0; }
    to { transform: translateX(0); opacity: 1; }
  }
  
  @keyframes slideOut {
    from { transform: translateX(0); opacity: 1; }
    to { transform: translateX(100%); opacity: 0; }
  }
  
  .notification.success { background: #4CAF50; }
  .notification.info { background: #2196F3; }
  .notification.warning { background: #FF9800; }
  .notification.error { background: #F44336; }
  
  .risk-high-risk { color: #f44336; font-weight: bold; }
  .risk-medium-risk { color: #ff9800; font-weight: bold; }
  .risk-low-risk { color: #4caf50; }
  .risk-ethical-rejection { color: #9c27b0; font-weight: bold; }
  
  .hash {
    font-family: 'Courier New', monospace;
    font-size: 0.85em;
    color: #888;
  }
`;
document.head.appendChild(enhancedStyles);

// Enhanced: Record consultation to local state
function recordConsultation(question, answer, framework, philosopher, determinacy, deception, risk, blockHash) {
  const consultation = {
    time: new Date().toLocaleTimeString(),
    question: question,
    answer: answer,
    framework: framework,
    philosopher: philosopher,
    determinacy: determinacy,
    deception: deception,
    risk: risk,
    blockHash: blockHash,
    timestamp: Date.now()
  };
  
  window.APP_STATE.consultationCount++;
  window.APP_STATE.blockchainData.push(consultation);
  
  // Update statistics
  updateStatistics();
  
  // Save to localStorage
  saveToLocalStorage();
  
  // Update display
  updateDashboardDisplay();
}

function updateStatistics() {
  const data = window.APP_STATE.blockchainData;
  if (data.length === 0) return;
  
  const totalDeception = data.reduce((sum, entry) => sum + parseFloat(entry.deception), 0);
  const totalDeterminacy = data.reduce((sum, entry) => sum + parseFloat(entry.determinacy), 0);
  
  window.APP_STATE.stats.avgDeception = totalDeception / data.length;
  window.APP_STATE.stats.avgDeterminacy = totalDeterminacy / data.length;
  window.APP_STATE.stats.truthRate = ((data.filter(entry => entry.deception < 0.1).length / data.length) * 100);
}

function saveToLocalStorage() {
  localStorage.setItem('oracleDashboardData', JSON.stringify({
    consultationCount: window.APP_STATE.consultationCount,
    blockchainData: window.APP_STATE.blockchainData,
    stats: window.APP_STATE.stats
  }));
}

// Override or enhance the existing answer display to record consultations
const originalDisplayAnswer = window.displayAnswer; // Assuming this exists in main.js
if (originalDisplayAnswer) {
  window.displayAnswer = function(data) {
    // Call original function
    originalDisplayAnswer(data);
    
    // Record the consultation
    recordConsultation(
      document.getElementById('q').value,
      data.answer,
      data.framework,
      data.philosopher,
      data.det,
      data.dec,
      data.risk,
      data.blockHash
    );
  };
}
</script>
</body>
</html>